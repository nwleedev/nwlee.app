---
title: '자바스크립트 클로저'
description: '자바스크립트에서 클로저가 도대체 무엇이고 어떤 역할을 하는지 작성해봤습니다.'
date: 2022-03-22T00:48:17+09:00
image: 'https://static.nwlee.com/public/L0ZXYIO0/b5bf5313-631a-4cfc-85aa-65bb993562a7.png'
math:
license:
hidden: false
comments: true
draft: true
tags: ['자바스크립트', '클로저', '렉시컬 스코프', 'JavaScript', 'Closure']
categories: ['자바스크립트']
---

# 클로저

프론트엔드 면접에서 자바스크립트 클로저가 무엇인가?라는 질문을 자주 받았다. 클로저가 무엇인지, 어떤 역할을 하는지 대강 알고 있었고 토이 프로젝트에서도 사용한 적도 있었다. 하지만 사람이 이해할 수 있을 정도로 설명하지 못하면 의미가 없어서 다시 개념을 공부하고 정리하기로 했다.

클로저는 함수와 함수가 선언된 렉시컬 환경의 조합이라고 MDN 문서에 적혀있다. 렉시컬 스코프는 변수의 유효범위를 지정하는 역할을 한다. 렉시컬 환경 객체는 모든 지역 변수를 속성으로 저장하는 객체인 환경 레코드와 선언된 함수의 외부 렉시컬 환경으로 구성된다.

환경 레코드는 모든 지역 변수를 속성으로 가지고 있는 객체이다. 변수는 자바스크립트의 특수 내부 객체인 환경 레코드의 속성이다. 변수를 가져오거나 변경하는 것은 곧 환경 레코드의 속성 값을 변경한다고 볼 수 있다.

## 렉시컬 스코프

```JavaScript
function fn001() {
  let str = "Hello World!"
  function fn002() {
    console.log(str)
  }
  fn002()
}
fn001()
```

fn001 함수 내부에는 str 문자열 변수와 fn002 함수가 선언되어 있다. fn001 함수가 실행되면 우선 문자열 변수와 함수가 각각 생성된다. fn002 함수가 실행될 때 fn002 내부에는 str 변수가 존재하지 않는 상황이다. 자바스크립트에서는 함수가 외부 함수에 정의된 변수에 접근할 수 있다. fn002 함수 입장에서는 외부 함수 fn001에 선언된 str 변수가 있기 때문에 콘솔에는 Hello World! 문자열이 출력될 것이다.

자바스크립트에서는 함수 내부에서 원하는 변수를 찾지 못하면 검색 범위를 내부 렉시컬 환경이 외부 렉시컬로 확장된다. 전역 렉시컬 환경으로 확장될 때까지 이 과정이 반복된다.

## 클로저

```JavaScript
function fn003() {
  let name = "I am not in function."
  function fn004() {
    console.log(name)
  }
  return fn004
}
const fn = fn003()
fn()
// I am not in function 문자열이 출력된다.
```

자바스크립트에서 함수도 일종의 값으로 취급할 수 있다. 하지만 함수 선언문은 선언 즉시 바로 초기화되는 점이 변수와 다르다. 즉, 함수 선언문으로 선언한 함수는 렉시컬 환경이 생성되는 즉시 사용할 수 있다. 함수를 호출하면 새로운 렉시컬 환경이 자동으로 생성되고 이 때 넘겨받은 매개변수와 지역 변수가 저장된다. 함수가 호출 중에는 함수 내부의 렉시컬 환경과 내부 렉시컬 환경이 참조하는 외부 렉시컬 환경을 나타낼 수 있다.

fn003 함수를 실행할 때마다 새로운 렉시컬 객체가 생성되고 name 문자열 변수가 렉시컬 환경에 저장된다. fn003 함수가 반환하는 fn004 함수는 함수가 생성된 곳의 렉시컬 환경을 기억한다. 자바스크립트에서 제공하는 숨김 속성, `[[Environment]]`은 함수가 정의된 곳의 렉시컬 환경에 대한 참조를 저장하는 특징이 있다. 예를 들어 fn004 함수에서 숨겨진 속성은 name 변수가 있는 렉시컬 환경에 대한 참조가 저장된다. 반환받은 fn004를 실행할 때마다 새로운 렉시컬 환경이 생성된다. 이 렉시컬 환경들은 `[[Environment]]` 속성에 저장된 렉시컬 환경을 외부 렉시컬 환경으로써 참조할 수 있게 된다.

반환받은 중첩 함수가 실행되면 자체 렉시컬 환경에서 name 변수를 찾는다. 중첩 함수에 변수가 없으면 해당 함수의 렉시컬 환경이 참조하는 외부 환경에서 name을 찾게 된다.

**정리하자면 클로저는 외부 렉시컬 환경에 정의된 변수를 기억하는 함수이다. 렉시컬 스코프는 함수 내부의 지역 변수와 외부 환경에 대한 참조로 구성된다. 모든 함수는 선언될 때 자신만의 렉시컬 스코프가 정해진다. 클로저는 숨김 속성 `[[Environment]]`을 사용하여 해당 속성이 참조하는 외부 렉시컬 환경이 무엇인지 알 수 있다. 함수가 실행될 때 숨겨진 속성을 사용해서 외부 환경에 정의된 변수에 접근할 수 있다.**

함수 호출이 종료되면 함수의 렉시컬 환경이 메모리에서 제거된다. 자바스크립트에서는 도달 가능한 객체만 메모리에 유지될 수 있기 때문이다. 함수 호출이 끝나도 여전히 렉시컬 환경에 도달할 수 있는 내부 함수가 있을 수 있다. `[[Environment]]` 속성에 의해 자신이 생성된, 외부 함수의 렉시컬 환경을 기억할 수 있기 때문이다. 함수 호출이 끝나도 렉시컬 환경은 도달 가능한 상태이므로 메모리에서 사라지지 않는다.

참조받는 렉시컬 환경을 제거하기 위해서는 해당 환경을 참고하는 함수를 제거해야 한다.
