---
title: 'JVM 메모리 관리'
description:
date: 2022-01-04T22:48:47+09:00
image:
math:
license:
hidden: false
comments: true
draft: true
tags:
  [
    '안드로이드',
    '코틀린',
    '프로세스',
    '스레드',
    '메모리',
    '힙',
    '스택',
    'Kotlin',
    'Android',
    'Process',
    'Thread',
    'Memory',
    'Heap',
    'Stack',
    'JVM',
  ]
categories: ['JVM']
---

# JVM의 메모리 관리

## JVM

자바 바이트코드를 실행할 수 있는 가상 머신이다. 자바로 작성된 프로그램이 운영체제와 관계없이 동작하는 것을 보장하기 위해 만들어졌다. 사용하지 않는 메모리 영역을 회수하는 가비지 콜렉션을 지원하며, 객체 지향 프로그래밍이 가상 머신에 구현되어있다.

## JVM의 메모리 구조

코드, 메소드, 스택, 힙 영역으로 나뉜다.

1. 메소드 영역

- 패키지 및 클래스 정보가 저장된다.
  - 클래스 멤버 변수의 이름, 타입, 접근 제어자 정보 등이 있다.
- Java에서 static으로 선언된 속성과 메소드도 메소드 영역에 저장된다.

2. 스택 영역

- 함수가 호출될 때마다 스택 프레임에 누적된다.
- Int와 같은 원시 타입 변수는 스택에 저장된다.
- 매개변수를 포함한 지역 변수 및 반환값은 스택 내 함수 프레임에 저장된다.
- 객체 인스턴스를 참조하는 변수는 스택에 저장된다.
- 함수가 값을 반환하면 스택에서 제거된다.

3. 힙 영역

- 동적 데이터 또는 객체를 저장하는데 사용되는 메모리 영역이다.
- 참조되지 않는 인스턴스가 있으면 가비지 콜렉션이 회수한다.
- 인스턴스는 힙 영역에 존재하지만, 인스턴스가 공유하는 메소드의 로직은 서로 같기 때문에 힙 영역에 올라가지 않는다.

## JVM에서의 가비지 콜렉션

JVM은 백그라운드에서 분리된 스레드를 실행시킨다. 마크 & 스윕 알고리즘이 사용된다.

GC Root는 가비지 콜렉터에 의해 사용되는 특별한 객체이다. 가비지 콜렉션의 시작 지점이 된다.

1. 가비지 콜렉터가 어떤 객체가 참조되는지 식별한다. 사용되거나 다른 객체에 의해 참조되는 객체들은 가비지 콜렉터에 의해 재귀적으로 순회된다.
2. 힙 영역 내 객체들을 순회할 때 참조되지 않는 것으로 판단된 객체들을 제거한다.
3. 필요없는 객체들을 제거하고 나서 아직 사용되는 객체들은 메모리의 앞 쪽으로 모인다. 메모리 파편화를 줄이고 새로운 객체를 원활히 할당할 수 있다.
